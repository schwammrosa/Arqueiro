<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense</title>
    <link rel="icon" type="image/x-icon" href="assets/imagen/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="skill-tree.css">
    <link rel="stylesheet" href="config-style.css">
</head>
<body>
    <div class="game-container">
        <div class="top-panel">
            <div class="stats">
                <div class="stat">
                    <span class="label">Vida:</span>
                    <span id="health" class="value">20</span>
                </div>
                <div class="stat">
                    <span class="label">Ouro:</span>
                    <span id="gold" class="value">100</span>
                </div>
                <div class="stat">
                    <span class="label">Onda:</span>
                    <span id="wave" class="value">1</span>
                </div>
                <div class="stat">
                    <span class="label">Monstros:</span>
                    <span id="monsters" class="value">0/0</span>
                </div>
                <div class="stat">
                    <span class="label">Tempo:</span>
                    <span id="gameTime" class="value">00:00</span>
                </div>
                <div class="stat">
                    <span class="label">Pr√≥xima Onda:</span>
                    <span id="nextWaveTimer" class="value">--</span>
                </div>
                <div class="stat">
                    <span class="label">Pontos:</span>
                    <span id="score" class="value">0</span>
                </div>
                <div class="stat">
                    <span class="label">Velocidade:</span>
                    <span id="gameSpeed" class="value">1x</span>
                </div>
            </div>
        </div>
        <div class="ui-panel">
            <div class="controls">
                <button id="start-wave" class="painel-lateral-btn onda" title="Iniciar pr√≥xima onda">
                    <span class="btn-icon">‚ñ∂Ô∏è</span>
                    <span class="btn-text">PR√ìXIMA ONDA</span>
                </button>
                <button id="pause" class="painel-lateral-btn pausar" title="Pausar/Continuar jogo">
                    <span class="btn-icon">‚è∏Ô∏è</span>
                    <span class="btn-text">Pausar</span>
                </button>
                <button id="speedButton" class="painel-lateral-btn velocidade" title="Alterar velocidade do jogo (1x)">
                    <span class="btn-icon">‚ö°</span>
                    <span class="btn-text">1x</span>
                </button>
                <a href="config.html" class="painel-lateral-btn config" title="Configura√ß√µes do jogo">
                    <span class="btn-icon">‚öôÔ∏è</span>
                    <span class="btn-text">Configura√ß√µes</span>
                </a>
                <button id="btnUpgrades" class="painel-lateral-btn upgrades" title="√Årvore de habilidades">
                    <span class="btn-icon">‚≠ê</span>
                    <span class="btn-text">Upgrades</span>
                </button>
            </div>
        </div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="game-over" id="gameOver" style="display: none;">
            <div class="game-over-content">
                <h2>Game Over!</h2>
                <p>Voc√™ sobreviveu a <span id="final-wave">0</span> ondas!</p>
                <button id="restart" class="btn">Jogar Novamente</button>
            </div>
        </div>

        <!-- Painel de informa√ß√µes da torre -->
        <div class="tower-info-panel" id="towerInfoPanel" style="display: none;">
            <div class="tower-info-content">
                <h3 id="towerInfoTitle">Informa√ß√µes da Torre</h3>
                <div class="tower-stats">
                    <div class="stat">
                        <span class="label">N√≠vel:</span>
                        <span id="towerLevel">1</span>
                    </div>
                    <div class="stat">
                        <span class="label">Dano:</span>
                        <span id="towerDamage">15</span>
                    </div>
                    <div class="stat">
                        <span class="label">Alcance:</span>
                        <span id="towerRange">120</span>
                    </div>
                    <div class="stat">
                        <span class="label">Taxa de Tiro:</span>
                        <span id="towerFireRate">1000ms</span>
                    </div>
                </div>
                <div class="tower-actions">
                    <button id="upgradeTower" class="btn btn-success">‚¨ÜÔ∏è Evoluir (<span id="upgradeCost">50</span>)</button>
                    <button id="sellTower" class="btn btn-danger">üí∞ Vender (<span id="sellValue">25</span>)</button>
                    <button id="closeTowerInfo" class="btn btn-secondary">‚ùå Fechar</button>
                </div>
            </div>
        </div>

        <div class="footer-tower-bar" id="footerTowerBar">
            <!-- As op√ß√µes de torres ser√£o geradas dinamicamente pelo JS -->
        </div>
    </div>
    
    <script src="game.js" type="module"></script>
    <script src="config.js" type="module"></script>

    <div id="specialSkillsFixedBar">
        <button id="btnArrowRain" class="special-skill-btn" title="Chuva de Flechas (Recarga)">
            üèπ<br><span class="skill-label">Chuva de Flechas</span>
            <span class="skill-cooldown" id="arrowRainCooldown"></span>
        </button>
        <button id="btnIceStorm" class="special-skill-btn" title="Tempestade de Gelo (Recarga)" style="display:none;">
            ‚ùÑÔ∏è<br><span class="skill-label">Tempestade de Gelo</span>
            <span class="skill-cooldown" id="iceStormCooldown"></span>
        </button>
    </div>

    <div id="infoTooltip" class="info-tooltip" style="display:none;"></div>
    


    <!-- Painel/modal de upgrades -->
    <div id="upgradeModal" class="upgrade-modal" style="display:none;">
        <div class="upgrade-modal-content">
            <span id="closeUpgradeModal" class="close-modal">&times;</span>
            <h2>Upgrades Globais</h2>
            <div id="upgradePointsInfo">Pontos dispon√≠veis: <span id="upgradePoints">0</span></div>
            <div id="upgradeList"></div>
        </div>
    </div>

    <div id="mainMenu" class="main-menu-overlay">
        <div class="main-menu-content">
            <h1 class="main-menu-title">Tower Defense</h1>
            <p style="color: #4fdfff; text-align: center; margin-bottom: 20px; font-size: 1.1em;">
                Modo Infinito - Sobreviva o m√°ximo de ondas poss√≠vel!
            </p>
            <button id="btnPlay" class="main-menu-btn">Jogar</button>
            <button id="btnContinue" class="main-menu-btn btn-continue" style="display: none;">Continuar</button>
            <button id="btnMenuConfig" class="main-menu-btn">Configura√ß√µes</button>
            <button id="btnMenuCredits" class="main-menu-btn">Cr√©ditos</button>
        </div>
    </div>

    <div id="creditsModal" class="main-menu-modal" style="display:none;">
        <div class="main-menu-modal-content">
            <span id="closeCreditsModal" class="main-menu-close">&times;</span>
            <h2>Cr√©ditos</h2>
            <p>Desenvolvido por [Seu Nome ou Equipe].<br>Inspirado em cl√°ssicos do g√™nero Tower Defense.<br><br>Projeto open-source para fins de estudo e divers√£o.</p>
        </div>
    </div>

    <style>
    .main-menu-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(135deg, #181c24 80%, #4fdfff 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    .main-menu-content {
        background: #222b3a;
        border-radius: 18px;
        box-shadow: 0 8px 40px #000a;
        padding: 48px 40px 40px 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 320px;
        max-width: 400px;
    }
    .main-menu-title {
        color: #4fdfff;
        font-size: 2.2em;
        font-weight: bold;
        margin-bottom: 32px;
        text-shadow: 0 2px 12px #000a;
        letter-spacing: 1px;
    }
    .main-menu-btn {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 16px 20px;
        margin: 12px 0;
        font-size: 1.2em;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 2px 12px #0004;
        transition: all 0.3s ease;
        width: 200px;
        min-height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    .main-menu-btn:hover {
        background: linear-gradient(135deg, #4fdfff, #007bff);
        transform: translateY(-2px) scale(1.04);
    }
    .btn-continue {
        background: linear-gradient(135deg, #28a745, #1e7e34) !important;
        color: white !important;
        font-weight: bold !important;
        position: relative;
        overflow: hidden;
        flex-direction: column;
        line-height: 1.3;
        padding: 12px 20px;
    }
    .btn-continue:hover {
        background: linear-gradient(135deg, #34ce57, #28a745) !important;
        transform: translateY(-2px) scale(1.04);
    }
    .btn-continue .onda-info {
        font-size: 0.85em;
        font-weight: normal;
        opacity: 0.9;
        margin-top: 2px;
    }

    .main-menu-modal {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    }
    .main-menu-modal-content {
        background: #fff;
        color: #222b3a;
        border-radius: 12px;
        padding: 32px 28px;
        min-width: 300px;
        max-width: 90vw;
        box-shadow: 0 8px 32px #000a;
        position: relative;
        text-align: center;
    }
    .main-menu-close {
        position: absolute;
        top: 12px;
        right: 18px;
        font-size: 2em;
        color: #4fdfff;
        cursor: pointer;
    }
    
    /* Responsividade para celular */
    @media (max-width: 768px) {
        .main-menu-content {
            padding: 32px 24px 24px 24px;
            min-width: 280px;
            max-width: 90vw;
            margin: 0 16px;
        }
        
        .main-menu-title {
            font-size: 1.8em;
            margin-bottom: 24px;
        }
        
        .main-menu-btn {
            width: 180px;
            min-height: 50px;
            font-size: 1.1em;
            padding: 14px 16px;
            margin: 8px 0;
        }
        
        .btn-continue {
            padding: 10px 16px;
            line-height: 1.2;
        }
        
        .btn-continue .onda-info {
            font-size: 0.8em;
            margin-top: 1px;
        }
    }
    
    @media (max-width: 480px) {
        .main-menu-content {
            padding: 24px 16px 16px 16px;
            min-width: 260px;
            margin: 0 8px;
        }
        
        .main-menu-title {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        
        .main-menu-btn {
            width: 160px;
            min-height: 46px;
            font-size: 1em;
            padding: 12px 14px;
            margin: 6px 0;
        }
        
        .btn-continue {
            padding: 8px 14px;
        }
        
        .btn-continue .onda-info {
            font-size: 0.75em;
        }
    }
    </style>

    <script>
    // Fun√ß√µes de debug globais
    window.debugMode = false;
    window.toggleDebug = function() {
        window.debugMode = !window.debugMode;
        console.log(`Modo debug ${window.debugMode ? 'ativado' : 'desativado'}`);
        
        // Atualizar texto do bot√£o
        const debugButton = document.getElementById('debugButton');
        if (debugButton) {
            debugButton.textContent = `Debug: ${window.debugMode ? 'ON' : 'OFF'}`;
            debugButton.style.background = window.debugMode ? '#ff6600' : '#333';
        }
        
        if (window.debugMode) {
            console.log('Para testar a explos√£o do canh√£o, coloque uma torre canh√£o e observe os logs no console');
            console.log('Use testExplosion(x, y, radius) para testar explos√µes manualmente');
        }
    };

    // Fun√ß√£o para testar explos√£o manualmente
    window.testExplosion = function(x, y, radius) {
        if (!window.gameSystem || !window.gameSystem.gameState) {
            console.log('Sistema de jogo n√£o inicializado');
            return;
        }
        
        console.log(`Testando explos√£o em (${x}, ${y}) com raio ${radius}`);
        
        // Simular uma explos√£o
        let hitCount = 0;
        const enemies = [...window.gameSystem.gameState.enemies];
        
        for (let enemy of enemies) {
            if (!enemy || !enemy.health || enemy.health <= 0 || enemy.isRemoved) continue;
            
            const dx = enemy.x - x;
            const dy = enemy.y - y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance <= radius) {
                hitCount++;
                console.log(`‚úÖ Teste: inimigo atingido a ${distance.toFixed(1)}px`);
            } else {
                console.log(`‚ùå Teste: inimigo fora da √°rea (${distance.toFixed(1)}px > ${radius}px)`);
            }
        }
        
        console.log(`üéØ Teste: ${hitCount} inimigos seriam atingidos`);
    };

    // Fun√ß√£o para testar o bot√£o "Continuar"
    window.testContinuarButton = function(onda = 5) {
        // Simular progresso
        localStorage.setItem('maiorOndaAtingida', onda.toString());
        console.log(`Progresso simulado: Onda ${onda} salva`);
        
        // Atualizar bot√£o
        if (typeof window.adicionarBotaoContinuarMenu !== 'undefined') {
            window.adicionarBotaoContinuarMenu();
            console.log('Bot√£o "Continuar" atualizado');
        }
        
        // Mostrar status
        const btn = document.getElementById('btnContinue');
        if (btn) {
            console.log('Bot√£o encontrado. Vis√≠vel:', btn.style.display);
            console.log('Conte√∫do HTML:', btn.innerHTML);
        }
    };

    // Fun√ß√£o para testar responsividade
    window.testResponsividade = function() {
        const info = {
            tela: `${window.innerWidth}x${window.innerHeight}`,
            dispositivo: window.innerWidth <= 480 ? 'Celular' : window.innerWidth <= 768 ? 'Tablet' : 'Desktop',
            canvas: document.getElementById('gameCanvas'),
            orientacao: window.innerHeight > window.innerWidth ? 'Retrato' : 'Paisagem'
        };
        
        console.log('üì± Teste de Responsividade:', info);
        
        if (info.canvas) {
            console.log('Canvas:', {
                dimensaoInterna: `${info.canvas.width}x${info.canvas.height}`,
                dimensaoCSS: `${info.canvas.style.width} x ${info.canvas.style.height}`,
                visivel: info.canvas.offsetWidth > 0
            });
        }
        
        return info;
    };

    // Menu inicial
    document.addEventListener('DOMContentLoaded', function() {
        const menu = document.getElementById('mainMenu');
        const btnPlay = document.getElementById('btnPlay');
        const btnContinue = document.getElementById('btnContinue');
        const btnConfig = document.getElementById('btnMenuConfig');
        const btnCredits = document.getElementById('btnMenuCredits');
        const creditsModal = document.getElementById('creditsModal');
        const closeCreditsModal = document.getElementById('closeCreditsModal');
        const debugButton = document.getElementById('debugButton');

        // Bot√£o de debug
        if (debugButton) {
            debugButton.addEventListener('click', function() {
                window.toggleDebug();
            });
        }

        // Ao clicar em Jogar, esconde o menu e inicia o jogo
        btnPlay.onclick = function() {
            menu.style.display = 'none';
            // Iniciar o game loop se ainda n√£o foi iniciado
            if (typeof window.gameSystem !== 'undefined' && window.gameSystem && !window.gameSystem.isRunning) {
                window.gameSystem.startGameLoop();
            } else if (typeof gameSystem !== 'undefined' && gameSystem && !gameSystem.isRunning) {
                gameSystem.startGameLoop();
            }
        };
        
        // Ao clicar em Continuar, esconde o menu e inicia o modo continuar
        btnContinue.onclick = function() {
            menu.style.display = 'none';
            if (typeof window.iniciarModoContinuar !== 'undefined') {
                window.iniciarModoContinuar();
            } else {
                console.log('Fun√ß√£o iniciarModoContinuar n√£o encontrada');
            }
        };
        
        // Verificar se deve mostrar o bot√£o "Continuar" (com delay para garantir que game.js foi carregado)
        setTimeout(function() {
            if (typeof window.adicionarBotaoContinuarMenu !== 'undefined') {
                window.adicionarBotaoContinuarMenu();
            }
        }, 100);
        // Configura√ß√µes: vai para config.html
        btnConfig.onclick = function() {
            window.location.href = 'config.html';
        };
        // Cr√©ditos: mostra modal
        btnCredits.onclick = function() {
            creditsModal.style.display = 'flex';
        };
        closeCreditsModal.onclick = function() {
            creditsModal.style.display = 'none';
        };
        // Fechar modal ao clicar fora
        creditsModal.onclick = function(e) {
            if (e.target === creditsModal) creditsModal.style.display = 'none';
        };
    });


    </script>
</body>
</html> 