<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For√ßar Sprites - Teste</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        canvas { border: 2px solid #333; background: #2a2a2a; }
        .info { margin: 20px 0; padding: 10px; background: #333; border-radius: 5px; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
    </style>
</head>
<body>
    <h1>üéÆ For√ßar Sprites - Teste</h1>
    
    <div class="info">
        <h3>Status:</h3>
        <div id="status">Carregando...</div>
    </div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div class="info">
        <h3>Controles:</h3>
        <button onclick="spawnEnemy()">Spawnar Inimigo</button>
        <button onclick="forceSprites()">For√ßar Sprites</button>
        <span id="spriteStatus">Status: Aguardando...</span>
    </div>

    <script type="module">
        import { MonsterSpriteManager } from './js/systems/MonsterSpriteManager.js';
        import { imageManager } from './js/systems/ImageManager.js';
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('status');
        const spriteStatusDiv = document.getElementById('spriteStatus');
        
        let monsterSpriteManager;
        let enemies = [];
        let forceSpritesMode = false;
        
        // Simular gameState
        const gameState = {
            gameTime: 0,
            enemies: enemies
        };
        
        async function initializeSystem() {
            try {
                statusDiv.textContent = 'Inicializando sistema...';
                
                // Criar MonsterSpriteManager
                monsterSpriteManager = new MonsterSpriteManager(imageManager);
                
                // Aguardar um pouco
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Tentar carregar monstros
                const success = await monsterSpriteManager.loadAllMonsters();
                
                if (success) {
                    statusDiv.innerHTML = '<span class="success">‚úÖ Sistema inicializado com sucesso!</span>';
                    spriteStatusDiv.textContent = 'Status: Pronto para usar sprites';
                } else {
                    statusDiv.innerHTML = '<span class="error">‚ùå Falha ao inicializar sprites</span>';
                    spriteStatusDiv.textContent = 'Status: Fallback dispon√≠vel';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
                console.error('Erro:', error);
            }
        }
        
        function spawnEnemy() {
            const enemy = {
                type: 'normal',
                x: 20,
                y: 220,
                direction: 'right',
                pathIndex: 0,
                isRemoved: false
            };
            
            enemies.push(enemy);
            console.log('üéØ Inimigo spawnado:', enemy);
        }
        
        function forceSprites() {
            forceSpritesMode = !forceSpritesMode;
            spriteStatusDiv.textContent = `Status: ${forceSpritesMode ? 'For√ßando sprites' : 'Modo normal'}`;
            console.log('üîÑ Modo sprites:', forceSpritesMode ? 'FOR√áADO' : 'NORMAL');
        }
        
        function updateEnemies() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                enemy.x += 1;
                if (enemy.x > canvas.width) {
                    enemies.splice(i, 1);
                }
            }
        }
        
        function drawEnemies() {
            if (forceSpritesMode && monsterSpriteManager) {
                // For√ßar uso de sprites
                enemies.forEach(enemy => {
                    try {
                        monsterSpriteManager.drawMonster(ctx, enemy, gameState.gameTime);
                    } catch (error) {
                        console.error('Erro ao desenhar sprite:', error);
                        // Fallback
                        ctx.fillStyle = '#ff0000';
                        ctx.beginPath();
                        ctx.arc(enemy.x, enemy.y, 15, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
            } else {
                // Desenho geom√©trico
                enemies.forEach(enemy => {
                    ctx.fillStyle = '#ff0000';
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(enemy.direction, enemy.x - 10, enemy.y - 20);
                });
            }
        }
        
        function gameLoop() {
            // Limpar canvas
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar grid
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 40) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Atualizar e desenhar inimigos
            updateEnemies();
            drawEnemies();
            
            // Atualizar tempo
            gameState.gameTime += 16;
            
            requestAnimationFrame(gameLoop);
        }
        
        // Inicializar e iniciar
        initializeSystem().then(() => {
            gameLoop();
        });
        
        // Fun√ß√µes globais para os bot√µes
        window.spawnEnemy = spawnEnemy;
        window.forceSprites = forceSprites;
    </script>
</body>
</html> 