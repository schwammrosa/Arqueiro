<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Preview das Torres</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #2c3e50;
            color: white;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .canvas-container {
            position: relative;
            margin: 20px 0;
        }
        #gameCanvas {
            border: 2px solid #3498db;
            background: #34495e;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #34495e;
            border-radius: 8px;
        }
        .tower-btn {
            padding: 10px 15px;
            margin: 5px;
            background: #3498db;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
        }
        .tower-btn:hover {
            background: #2980b9;
        }
        .tower-btn.selected {
            background: #e74c3c;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
        .info { background: #3498db; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste - Preview das Torres</h1>
        
        <div class="status info">
            <strong>Instru√ß√µes:</strong> Clique em uma torre para selecion√°-la, depois mova o mouse sobre o canvas para ver o preview.
        </div>
        
        <div class="controls">
            <h3>üèóÔ∏è Selecionar Torre:</h3>
            <button class="tower-btn" data-type="archer">üèπ Arqueiro</button>
            <button class="tower-btn" data-type="cannon">üöÄ Canh√£o</button>
            <button class="tower-btn" data-type="magic">üîÆ M√°gica</button>
            <button class="tower-btn" data-type="tesla">‚ö° Tesla</button>
            <button class="tower-btn" onclick="clearSelection()">‚ùå Limpar</button>
        </div>
        
        <div class="canvas-container">
            <canvas id="gameCanvas" width="600" height="400"></canvas>
        </div>
        
        <div id="status" class="status info">Aguardando sele√ß√£o de torre...</div>
        <div id="logs" style="background: #2c3e50; padding: 10px; border-radius: 4px; font-family: monospace; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <script type="module">
        // Importar ImageManager
        import { ImageManager } from './js/systems/ImageManager.js';
        
        let imageManager;
        let selectedTowerType = null;
        let mouseX = 0, mouseY = 0;
        
        // Fun√ß√£o para adicionar logs
        function addLog(message) {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }
        
        // Fun√ß√£o para atualizar status
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        // Inicializar ImageManager
        async function initializeImageManager() {
            addLog('üöÄ Iniciando ImageManager...');
            imageManager = new ImageManager();
            
            // Carregar imagens das torres
            const towerImages = {
                archer: 'assets/imagen/Torres/arqueiro.png',
                cannon: 'assets/imagen/Torres/canhao.png',
                magic: 'assets/imagen/Torres/magica.png',
                tesla: 'assets/imagen/Torres/tesla.png'
            };
            
            addLog('üìÅ Carregando imagens das torres...');
            const success = await imageManager.loadImages(towerImages);
            addLog(`‚úÖ Carregamento: ${success ? 'SUCESSO' : 'FALHA'}`);
            
            // Verificar cada imagem
            Object.keys(towerImages).forEach(type => {
                const image = imageManager.getImage(type);
                addLog(`üîç ${type}: ${image ? 'CARREGADA' : 'N√ÉO CARREGADA'}`);
            });
            
            updateStatus('ImageManager inicializado! Selecione uma torre.', 'success');
        }
        
        // Fun√ß√£o para desenhar preview
        function drawTowerPreview(ctx, mouseX, mouseY, towerType) {
            const image = imageManager.getImage(towerType);
            const gridSize = 40;
            
            addLog(`üéØ Tentando desenhar preview para ${towerType} em (${mouseX}, ${mouseY})`);
            addLog(`üñºÔ∏è Imagem encontrada: ${image ? 'SIM' : 'N√ÉO'}`);
            
            if (image) {
                ctx.globalAlpha = 0.7;
                ctx.drawImage(
                    image,
                    mouseX - gridSize / 2,
                    mouseY - gridSize / 2,
                    gridSize,
                    gridSize
                );
                ctx.globalAlpha = 1.0;
                addLog('‚úÖ Preview desenhado com imagem');
            } else {
                // Fallback
                const towerConfigs = {
                    archer: { color: '#4e73df', icon: 'üèπ' },
                    cannon: { color: '#e74a3b', icon: 'üöÄ' },
                    magic: { color: '#36b9cc', icon: 'üîÆ' },
                    tesla: { color: '#7d5fff', icon: '‚ö°' }
                };
                
                const config = towerConfigs[towerType] || { color: '#888', icon: '‚ùì' };
                
                ctx.fillStyle = config.color;
                ctx.globalAlpha = 0.5;
                ctx.fillRect(
                    mouseX - gridSize / 2,
                    mouseY - gridSize / 2,
                    gridSize,
                    gridSize
                );
                
                ctx.font = '16px Arial';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText(config.icon, mouseX, mouseY + 4);
                
                ctx.globalAlpha = 1.0;
                addLog('‚ö†Ô∏è Preview desenhado com fallback');
            }
        }
        
        // Fun√ß√£o para desenhar canvas
        function drawCanvas() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // Limpar canvas
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            const gridSize = 40;
            
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Desenhar preview se houver torre selecionada
            if (selectedTowerType) {
                drawTowerPreview(ctx, mouseX, mouseY, selectedTowerType);
            }
        }
        
        // Event listeners
        document.querySelectorAll('.tower-btn[data-type]').forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                selectedTowerType = type;
                
                // Atualizar bot√µes
                document.querySelectorAll('.tower-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                
                updateStatus(`Torre selecionada: ${type}`, 'success');
                addLog(`üéØ Torre selecionada: ${type}`);
            });
        });
        
        // Mouse move
        document.getElementById('gameCanvas').addEventListener('mousemove', (e) => {
            const rect = e.target.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
            drawCanvas();
        });
        
        // Fun√ß√£o global para limpar sele√ß√£o
        window.clearSelection = () => {
            selectedTowerType = null;
            document.querySelectorAll('.tower-btn').forEach(b => b.classList.remove('selected'));
            updateStatus('Sele√ß√£o limpa', 'info');
            addLog('üßπ Sele√ß√£o limpa');
            drawCanvas();
        };
        
        // Inicializar
        initializeImageManager().then(() => {
            drawCanvas();
        });
    </script>
</body>
</html> 