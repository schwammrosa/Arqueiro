<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Corre√ß√£o da Velocidade dos Monstros</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #4fdfff;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #1a4a1a;
            border-left: 4px solid #00ff00;
        }
        .error {
            background: #4a1a1a;
            border-left: 4px solid #ff0000;
        }
        .warning {
            background: #4a4a1a;
            border-left: 4px solid #ffff00;
        }
        .info {
            background: #1a1a4a;
            border-left: 4px solid #0066ff;
        }
        button {
            background: #4fdfff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3bc8c8;
        }
        .log {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .speed-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .speed-table th, .speed-table td {
            border: 1px solid #444;
            padding: 8px;
            text-align: center;
        }
        .speed-table th {
            background: #333;
        }
        .speed-table tr:nth-child(even) {
            background: #2a2a2a;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste - Corre√ß√£o da Velocidade dos Monstros</h1>
    
    <div class="test-section">
        <h2>üîß Prepara√ß√£o do Teste</h2>
        <p>Este teste verifica se o problema da velocidade dos monstros no modo continuar foi corrigido.</p>
        
        <button onclick="setupSpeedTest()">üîß Configurar Teste de Velocidade</button>
        <button onclick="runSpeedTest()">‚ñ∂Ô∏è Executar Teste de Velocidade</button>
        <button onclick="clearLog()">üóëÔ∏è Limpar Log</button>
        <button onclick="resetConfigs()">üîÑ Resetar Configura√ß√µes</button>
    </div>
    
    <div class="test-section">
        <h2>üìä Resultados do Teste</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>üìà Tabela de Velocidades por Onda</h2>
        <div id="speedTable"></div>
    </div>
    
    <div class="test-section">
        <h2>üìù Log de Execu√ß√£o</h2>
        <div id="testLog" class="log"></div>
    </div>
    
    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[SPEED_TEST] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        function addResult(testName, success, details = '') {
            const result = { testName, success, details, timestamp: new Date() };
            testResults.push(result);
            
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>${testName}:</strong> ${success ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsDiv.appendChild(resultDiv);
        }
        
        function setupSpeedTest() {
            log('üîß Configurando teste de velocidade...');
            
            // Simular configura√ß√µes de dificuldade normal
            const config = {
                initialHealth: 20,
                initialGold: 100,
                waveDelaySeconds: 5,
                enemyBaseHealth: 50,
                enemyHealthIncrease: 15,
                enemySpeed: 0.5,
                enemySpeedMultiplier: 1.15,
                enemyReward: 10,
                enemiesPerWave: 8,
                enemiesIncrease: 3,
                goldMultiplier: 1,
                enemyHealthMultiplier: 1.25,
                enemySpawnRate: 1000
            };
            
            // Salvar configura√ß√µes
            localStorage.setItem('arqueiroConfig', JSON.stringify(config));
            localStorage.setItem('selectedDifficulty', 'normal');
            localStorage.setItem('progress_normal', '5');
            
            log('‚úÖ Configura√ß√µes de teste salvas');
            log(`üìä Velocidade base: ${config.enemySpeed}`);
            log(`üìä Multiplicador de velocidade: ${config.enemySpeedMultiplier}`);
            log(`üìä Progresso salvo: onda 5`);
            
            addResult('Configura√ß√£o de Teste', true, 
                `Velocidade: ${config.enemySpeed}, Multiplicador: ${config.enemySpeedMultiplier}`);
        }
        
        function runSpeedTest() {
            log('‚ñ∂Ô∏è Iniciando teste de velocidade...');
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            
            // Teste 1: Verificar se as configura√ß√µes s√£o carregadas corretamente
            testConfigLoading();
            
            // Teste 2: Verificar c√°lculo de velocidade por onda
            testSpeedCalculation();
            
            // Teste 3: Verificar se o GAME_CONFIG √© atualizado
            testGameConfigUpdate();
            
            // Teste 4: Verificar velocidade por tipo de inimigo
            testEnemyTypeSpeed();
            
            // Gerar tabela de velocidades
            generateSpeedTable();
            
            log('‚úÖ Teste de velocidade conclu√≠do!');
        }
        
        function testConfigLoading() {
            log('üîç Testando carregamento de configura√ß√µes...');
            
            try {
                const savedConfig = localStorage.getItem('arqueiroConfig');
                const config = savedConfig ? JSON.parse(savedConfig) : {};
                
                if (config.enemySpeed && config.enemySpeedMultiplier) {
                    log(`‚úÖ Configura√ß√µes carregadas: Velocidade=${config.enemySpeed}, Multiplicador=${config.enemySpeedMultiplier}`);
                    addResult('Carregamento de Configura√ß√µes', true, 
                        `Velocidade: ${config.enemySpeed}, Multiplicador: ${config.enemySpeedMultiplier}`);
                } else {
                    throw new Error('Configura√ß√µes de velocidade n√£o encontradas');
                }
            } catch (error) {
                log(`‚ùå Erro ao carregar configura√ß√µes: ${error.message}`);
                addResult('Carregamento de Configura√ß√µes', false, error.message);
            }
        }
        
        function testSpeedCalculation() {
            log('üîç Testando c√°lculo de velocidade por onda...');
            
            try {
                const config = JSON.parse(localStorage.getItem('arqueiroConfig') || '{}');
                const selectedDifficulty = localStorage.getItem('selectedDifficulty') || 'normal';
                const progressKey = `progress_${selectedDifficulty}`;
                const maiorOnda = parseInt(localStorage.getItem(progressKey) || '1');
                
                // Simular c√°lculo de velocidade para diferentes ondas
                const speeds = [];
                for (let wave = 1; wave <= 10; wave++) {
                    const waveSpeedMultiplier = Math.pow(config.enemySpeedMultiplier, wave - 1);
                    const baseSpeed = config.enemySpeed;
                    const finalSpeed = baseSpeed * waveSpeedMultiplier;
                    speeds.push({ wave, speed: finalSpeed, multiplier: waveSpeedMultiplier });
                }
                
                log(`üìä Velocidades calculadas para ondas 1-10:`);
                speeds.forEach(s => {
                    log(`   Onda ${s.wave}: ${s.speed.toFixed(3)} (x${s.multiplier.toFixed(3)})`);
                });
                
                // Verificar se a velocidade aumenta corretamente
                const speedIncrease = speeds[4].speed > speeds[0].speed; // Onda 5 > Onda 1
                
                if (speedIncrease) {
                    log('‚úÖ Velocidade aumenta corretamente com a onda');
                    addResult('C√°lculo de Velocidade', true, 
                        `Onda 1: ${speeds[0].speed.toFixed(3)}, Onda 5: ${speeds[4].speed.toFixed(3)}`);
                } else {
                    throw new Error('Velocidade n√£o est√° aumentando com a onda');
                }
            } catch (error) {
                log(`‚ùå Erro no c√°lculo de velocidade: ${error.message}`);
                addResult('C√°lculo de Velocidade', false, error.message);
            }
        }
        
        function testGameConfigUpdate() {
            log('üîç Testando atualiza√ß√£o do GAME_CONFIG...');
            
            try {
                // Simular a fun√ß√£o loadGameConfig
                const savedConfig = localStorage.getItem('arqueiroConfig');
                const config = savedConfig ? JSON.parse(savedConfig) : {};
                
                // Simular atualiza√ß√£o do GAME_CONFIG
                const GAME_CONFIG = { ...config };
                
                if (GAME_CONFIG.enemySpeed && GAME_CONFIG.enemySpeedMultiplier) {
                    log(`‚úÖ GAME_CONFIG atualizado: Velocidade=${GAME_CONFIG.enemySpeed}, Multiplicador=${GAME_CONFIG.enemySpeedMultiplier}`);
                    addResult('Atualiza√ß√£o do GAME_CONFIG', true, 
                        `Velocidade: ${GAME_CONFIG.enemySpeed}, Multiplicador: ${GAME_CONFIG.enemySpeedMultiplier}`);
                } else {
                    throw new Error('GAME_CONFIG n√£o cont√©m configura√ß√µes de velocidade');
                }
            } catch (error) {
                log(`‚ùå Erro na atualiza√ß√£o do GAME_CONFIG: ${error.message}`);
                addResult('Atualiza√ß√£o do GAME_CONFIG', false, error.message);
            }
        }
        
        function testEnemyTypeSpeed() {
            log('üîç Testando velocidade por tipo de inimigo...');
            
            try {
                const config = JSON.parse(localStorage.getItem('arqueiroConfig') || '{}');
                const wave = 5; // Onda de teste
                
                // Simular configura√ß√µes de tipos de inimigos
                const enemyTypes = {
                    normal: { speedMultiplier: 1.0 },
                    fast: { speedMultiplier: 1.8 },
                    tank: { speedMultiplier: 0.6 },
                    elite: { speedMultiplier: 0.8 }
                };
                
                const waveSpeedMultiplier = Math.pow(config.enemySpeedMultiplier, wave - 1);
                const baseSpeed = config.enemySpeed;
                
                const speeds = {};
                for (const [type, typeConfig] of Object.entries(enemyTypes)) {
                    const finalSpeed = baseSpeed * typeConfig.speedMultiplier * waveSpeedMultiplier;
                    speeds[type] = finalSpeed;
                    log(`   ${type}: ${finalSpeed.toFixed(3)} (x${typeConfig.speedMultiplier})`);
                }
                
                // Verificar se as velocidades s√£o diferentes por tipo
                const hasDifferentSpeeds = speeds.normal !== speeds.fast && speeds.tank !== speeds.elite;
                
                if (hasDifferentSpeeds) {
                    log('‚úÖ Velocidades diferentes por tipo de inimigo');
                    addResult('Velocidade por Tipo', true, 
                        `Normal: ${speeds.normal.toFixed(3)}, R√°pido: ${speeds.fast.toFixed(3)}`);
                } else {
                    throw new Error('Velocidades n√£o s√£o diferentes por tipo');
                }
            } catch (error) {
                log(`‚ùå Erro na velocidade por tipo: ${error.message}`);
                addResult('Velocidade por Tipo', false, error.message);
            }
        }
        
        function generateSpeedTable() {
            log('üìä Gerando tabela de velocidades...');
            
            try {
                const config = JSON.parse(localStorage.getItem('arqueiroConfig') || '{}');
                const enemyTypes = {
                    normal: { speedMultiplier: 1.0, name: 'Normal' },
                    fast: { speedMultiplier: 1.8, name: 'R√°pido' },
                    tank: { speedMultiplier: 0.6, name: 'Tanque' },
                    elite: { speedMultiplier: 0.8, name: 'Elite' }
                };
                
                let tableHTML = `
                    <table class="speed-table">
                        <thead>
                            <tr>
                                <th>Onda</th>
                                <th>Multiplicador</th>
                                <th>Normal</th>
                                <th>R√°pido</th>
                                <th>Tanque</th>
                                <th>Elite</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                for (let wave = 1; wave <= 10; wave++) {
                    const waveSpeedMultiplier = Math.pow(config.enemySpeedMultiplier, wave - 1);
                    const baseSpeed = config.enemySpeed;
                    
                    tableHTML += `<tr>
                        <td><strong>${wave}</strong></td>
                        <td>${waveSpeedMultiplier.toFixed(3)}x</td>
                    `;
                    
                    for (const [type, typeConfig] of Object.entries(enemyTypes)) {
                        const finalSpeed = baseSpeed * typeConfig.speedMultiplier * waveSpeedMultiplier;
                        tableHTML += `<td>${finalSpeed.toFixed(3)}</td>`;
                    }
                    
                    tableHTML += '</tr>';
                }
                
                tableHTML += '</tbody></table>';
                
                document.getElementById('speedTable').innerHTML = tableHTML;
                log('‚úÖ Tabela de velocidades gerada');
                
            } catch (error) {
                log(`‚ùå Erro ao gerar tabela: ${error.message}`);
                document.getElementById('speedTable').innerHTML = `<p style="color: #ff0000;">Erro: ${error.message}</p>`;
            }
        }
        
        function resetConfigs() {
            log('üîÑ Resetando configura√ß√µes...');
            
            // Limpar configura√ß√µes de teste
            localStorage.removeItem('arqueiroConfig');
            localStorage.removeItem('selectedDifficulty');
            localStorage.removeItem('progress_normal');
            
            // Limpar resultados
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('speedTable').innerHTML = '';
            
            log('‚úÖ Configura√ß√µes resetadas');
            addResult('Reset de Configura√ß√µes', true, 'Configura√ß√µes limpas');
        }
        
        // Executar configura√ß√£o autom√°tica ao carregar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina carregada. Clique em "Configurar Teste de Velocidade" para come√ßar.');
        });
    </script>
</body>
</html> 