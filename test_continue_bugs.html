<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Bugs do Modo Continuar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #4fdfff;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #1a4a1a;
            border-left: 4px solid #00ff00;
        }
        .error {
            background: #4a1a1a;
            border-left: 4px solid #ff0000;
        }
        .info {
            background: #1a1a4a;
            border-left: 4px solid #0066ff;
        }
        button {
            background: #4fdfff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3bc8c8;
        }
        .log {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste - Bugs do Modo Continuar</h1>
    
    <div class="test-section">
        <h2>üîß Prepara√ß√£o do Teste</h2>
        <p>Este teste verifica se os bugs do modo continuar foram corrigidos:</p>
        <ul>
            <li><strong>Bug 1:</strong> Velocidade dos monstros incorreta</li>
            <li><strong>Bug 2:</strong> N√£o conseguir colocar torres</li>
        </ul>
        
        <button onclick="setupTest()">üîß Configurar Teste</button>
        <button onclick="runTest()">‚ñ∂Ô∏è Executar Teste</button>
        <button onclick="clearLog()">üóëÔ∏è Limpar Log</button>
    </div>
    
    <div class="test-section">
        <h2>üìä Resultados do Teste</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>üìù Log de Execu√ß√£o</h2>
        <div id="testLog" class="log"></div>
    </div>
    
    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[TEST] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        function addResult(testName, success, details = '') {
            const result = { testName, success, details, timestamp: new Date() };
            testResults.push(result);
            
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>${testName}:</strong> ${success ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsDiv.appendChild(resultDiv);
        }
        
        function setupTest() {
            log('üîß Configurando teste...');
            
            // Simular progresso salvo
            localStorage.setItem('selectedDifficulty', 'normal');
            localStorage.setItem('progress_normal', '5');
            
            // Simular configura√ß√µes de dificuldade
            const config = {
                initialHealth: 20,
                initialGold: 100,
                waveDelaySeconds: 5,
                enemyBaseHealth: 50,
                enemyHealthIncrease: 15,
                enemySpeed: 0.5,
                enemySpeedMultiplier: 1.15,
                enemyReward: 10,
                enemiesPerWave: 8,
                enemiesIncrease: 3,
                goldMultiplier: 1
            };
            localStorage.setItem('arqueiroConfig', JSON.stringify(config));
            
            log('‚úÖ Configura√ß√£o do teste conclu√≠da');
            addResult('Configura√ß√£o', true, 'Dados de teste salvos no localStorage');
        }
        
        function runTest() {
            log('‚ñ∂Ô∏è Iniciando teste dos bugs do modo continuar...');
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            
            // Teste 1: Verificar se GAME_CONFIG √© carregado corretamente
            testGameConfigLoading();
            
            // Teste 2: Verificar se enemyPath √© carregado
            testEnemyPathLoading();
            
            // Teste 3: Verificar se as configura√ß√µes s√£o aplicadas
            testConfigApplication();
            
            // Teste 4: Verificar se o estado inicial est√° correto
            testInitialState();
            
            log('‚úÖ Teste conclu√≠do!');
        }
        
        function testGameConfigLoading() {
            log('üîç Testando carregamento do GAME_CONFIG...');
            
            try {
                // Simular a fun√ß√£o loadGameConfig
                const savedConfig = localStorage.getItem('arqueiroConfig');
                const config = savedConfig ? JSON.parse(savedConfig) : {};
                
                if (config.enemySpeed && config.enemySpeedMultiplier) {
                    log('‚úÖ GAME_CONFIG carregado com velocidade dos inimigos');
                    addResult('Carregamento GAME_CONFIG', true, 
                        `Velocidade: ${config.enemySpeed}, Multiplicador: ${config.enemySpeedMultiplier}`);
                } else {
                    throw new Error('Configura√ß√µes de velocidade n√£o encontradas');
                }
            } catch (error) {
                log(`‚ùå Erro ao carregar GAME_CONFIG: ${error.message}`);
                addResult('Carregamento GAME_CONFIG', false, error.message);
            }
        }
        
        function testEnemyPathLoading() {
            log('üîç Testando carregamento do enemyPath...');
            
            try {
                // Simular a fun√ß√£o loadEnemyPath
                const savedPath = localStorage.getItem('enemyPath');
                let enemyPath;
                
                if (savedPath) {
                    enemyPath = JSON.parse(savedPath);
                } else {
                    // Caminho padr√£o
                    enemyPath = [
                        {x: 0, y: 3}, {x: 1, y: 3}, {x: 2, y: 3}, {x: 3, y: 3}, {x: 4, y: 3},
                        {x: 5, y: 3}, {x: 6, y: 3}, {x: 7, y: 3}, {x: 8, y: 3}, {x: 9, y: 3},
                        {x: 10, y: 3}, {x: 11, y: 3}, {x: 12, y: 3}, {x: 13, y: 3}, {x: 14, y: 3},
                        {x: 15, y: 3}, {x: 16, y: 3}, {x: 17, y: 3}, {x: 18, y: 3}, {x: 19, y: 3}
                    ];
                }
                
                if (enemyPath && enemyPath.length > 0) {
                    log('‚úÖ enemyPath carregado corretamente');
                    addResult('Carregamento enemyPath', true, 
                        `${enemyPath.length} pontos no caminho`);
                } else {
                    throw new Error('Caminho dos inimigos vazio ou inv√°lido');
                }
            } catch (error) {
                log(`‚ùå Erro ao carregar enemyPath: ${error.message}`);
                addResult('Carregamento enemyPath', false, error.message);
            }
        }
        
        function testConfigApplication() {
            log('üîç Testando aplica√ß√£o das configura√ß√µes...');
            
            try {
                const config = JSON.parse(localStorage.getItem('arqueiroConfig') || '{}');
                const selectedDifficulty = localStorage.getItem('selectedDifficulty') || 'normal';
                const progressKey = `progress_${selectedDifficulty}`;
                const maiorOnda = parseInt(localStorage.getItem(progressKey) || '1');
                
                // Simular c√°lculo de velocidade para onda 5
                const waveSpeedMultiplier = Math.pow(config.enemySpeedMultiplier, maiorOnda - 1);
                const expectedSpeed = config.enemySpeed * waveSpeedMultiplier;
                
                log(`üìä Onda: ${maiorOnda}, Velocidade esperada: ${expectedSpeed.toFixed(3)}`);
                
                if (expectedSpeed > config.enemySpeed) {
                    log('‚úÖ Velocidade dos inimigos aumenta corretamente com a onda');
                    addResult('Aplica√ß√£o de Configura√ß√µes', true, 
                        `Velocidade base: ${config.enemySpeed}, Velocidade onda ${maiorOnda}: ${expectedSpeed.toFixed(3)}`);
                } else {
                    throw new Error('Velocidade n√£o est√° aumentando com a onda');
                }
            } catch (error) {
                log(`‚ùå Erro na aplica√ß√£o de configura√ß√µes: ${error.message}`);
                addResult('Aplica√ß√£o de Configura√ß√µes', false, error.message);
            }
        }
        
        function testInitialState() {
            log('üîç Testando estado inicial do modo continuar...');
            
            try {
                const config = JSON.parse(localStorage.getItem('arqueiroConfig') || '{}');
                const selectedDifficulty = localStorage.getItem('selectedDifficulty') || 'normal';
                const progressKey = `progress_${selectedDifficulty}`;
                const maiorOnda = parseInt(localStorage.getItem(progressKey) || '1');
                
                // Simular estado inicial
                const initialState = {
                    health: config.initialHealth,
                    gold: 0, // Ser√° calculado
                    wave: maiorOnda - 1,
                    selectedTower: null,
                    selectedTowerType: null,
                    towers: [],
                    enemies: [],
                    projectiles: []
                };
                
                // Verificar campos obrigat√≥rios
                const requiredFields = ['health', 'gold', 'wave', 'selectedTower', 'selectedTowerType', 'towers', 'enemies', 'projectiles'];
                const missingFields = requiredFields.filter(field => !(field in initialState));
                
                if (missingFields.length === 0) {
                    log('‚úÖ Estado inicial cont√©m todos os campos necess√°rios');
                    addResult('Estado Inicial', true, 
                        `Onda: ${initialState.wave}, Vida: ${initialState.health}, Torres: ${initialState.towers.length}`);
                } else {
                    throw new Error(`Campos faltantes: ${missingFields.join(', ')}`);
                }
            } catch (error) {
                log(`‚ùå Erro no estado inicial: ${error.message}`);
                addResult('Estado Inicial', false, error.message);
            }
        }
        
        // Executar configura√ß√£o autom√°tica ao carregar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina carregada. Clique em "Configurar Teste" para come√ßar.');
        });
    </script>
</body>
</html> 