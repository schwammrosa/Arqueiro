<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Jogo com Sprites</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        canvas { border: 2px solid #333; background: #2a2a2a; }
        .info { margin: 20px 0; padding: 10px; background: #333; border-radius: 5px; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
    </style>
</head>
<body>
    <h1>üéÆ Teste - Jogo com Sprites de Monstros</h1>
    
    <div class="info">
        <h3>Status:</h3>
        <div id="status">Carregando...</div>
    </div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div class="info">
        <h3>Controles:</h3>
        <button onclick="spawnEnemy()">Spawnar Inimigo</button>
        <button onclick="toggleSprites()">Alternar Sprites</button>
        <span id="spriteStatus">Sprites: Desabilitados</span>
    </div>

    <script type="module">
        import { MonsterSpriteManager } from './js/systems/MonsterSpriteManager.js';
        import { imageManager } from './js/systems/ImageManager.js';
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('status');
        const spriteStatusDiv = document.getElementById('spriteStatus');
        
        let monsterSpriteManager;
        let enemies = [];
        let useSprites = false;
        let monstersInitialized = false;
        
        // Simular gameState
        const gameState = {
            gameTime: 0,
            enemies: enemies
        };
        
        // Simular enemyPath
        const enemyPath = [
            { x: 0, y: 5 },
            { x: 1, y: 5 },
            { x: 2, y: 5 },
            { x: 3, y: 5 },
            { x: 4, y: 5 },
            { x: 5, y: 5 },
            { x: 6, y: 5 },
            { x: 7, y: 5 },
            { x: 8, y: 5 },
            { x: 9, y: 5 },
            { x: 10, y: 5 },
            { x: 11, y: 5 },
            { x: 12, y: 5 },
            { x: 13, y: 5 },
            { x: 14, y: 5 },
            { x: 15, y: 5 },
            { x: 16, y: 5 },
            { x: 17, y: 5 },
            { x: 18, y: 5 },
            { x: 19, y: 5 }
        ];
        
        // Configura√ß√£o do jogo
        const GAME_CONFIG = {
            gridSize: 40,
            canvasWidth: 800,
            canvasHeight: 600
        };
        
        async function initializeSystem() {
            try {
                statusDiv.textContent = 'Inicializando sistema...';
                
                // Criar MonsterSpriteManager
                monsterSpriteManager = new MonsterSpriteManager(imageManager);
                
                // Carregar monstros
                monstersInitialized = await monsterSpriteManager.loadAllMonsters();
                
                if (monstersInitialized) {
                    statusDiv.innerHTML = '<span class="success">‚úÖ Sistema inicializado com sucesso!</span>';
                    console.log('‚úÖ Sistema de sprites inicializado');
                } else {
                    statusDiv.innerHTML = '<span class="error">‚ùå Falha ao inicializar sprites</span>';
                    console.log('‚ùå Falha ao inicializar sprites');
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
                console.error('Erro:', error);
            }
        }
        
        function spawnEnemy() {
            const enemy = {
                type: 'normal',
                x: 20,
                y: 220,
                direction: 'right',
                pathIndex: 0,
                isRemoved: false
            };
            
            enemies.push(enemy);
            console.log('üéØ Inimigo spawnado:', enemy);
        }
        
        function toggleSprites() {
            useSprites = !useSprites;
            spriteStatusDiv.textContent = `Sprites: ${useSprites ? 'Habilitados' : 'Desabilitados'}`;
            console.log('üîÑ Sprites:', useSprites ? 'ON' : 'OFF');
        }
        
        function updateEnemies() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                
                // Mover inimigo
                enemy.x += 1;
                
                // Remover se saiu da tela
                if (enemy.x > canvas.width) {
                    enemies.splice(i, 1);
                }
            }
        }
        
        function drawEnemies() {
            if (useSprites && monstersInitialized) {
                // Usar sistema de sprites
                enemies.forEach(enemy => {
                    monsterSpriteManager.drawMonster(ctx, enemy, gameState.gameTime);
                });
            } else {
                // Usar desenho geom√©trico
                enemies.forEach(enemy => {
                    ctx.fillStyle = '#ff0000';
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Desenhar dire√ß√£o
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(enemy.direction, enemy.x - 10, enemy.y - 20);
                });
            }
        }
        
        function gameLoop() {
            // Limpar canvas
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar grid
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += GAME_CONFIG.gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += GAME_CONFIG.gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Desenhar caminho
            ctx.strokeStyle = '#8b7355';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let i = 0; i < enemyPath.length; i++) {
                const x = enemyPath[i].x * GAME_CONFIG.gridSize + GAME_CONFIG.gridSize / 2;
                const y = enemyPath[i].y * GAME_CONFIG.gridSize + GAME_CONFIG.gridSize / 2;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Atualizar e desenhar inimigos
            updateEnemies();
            drawEnemies();
            
            // Atualizar tempo
            gameState.gameTime += 16;
            
            requestAnimationFrame(gameLoop);
        }
        
        // Inicializar e iniciar
        initializeSystem().then(() => {
            gameLoop();
        });
        
        // Fun√ß√µes globais para os bot√µes
        window.spawnEnemy = spawnEnemy;
        window.toggleSprites = toggleSprites;
    </script>
</body>
</html> 