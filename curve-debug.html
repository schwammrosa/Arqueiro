<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug de Curvas - Arqueiro</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .sprites-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-width: 1200px;
            margin: 20px auto;
        }
        .sprite-box {
            border: 3px solid #333;
            background-color: white;
            padding: 15px;
            text-align: center;
            position: relative;
            border-radius: 8px;
        }
        .sprite-box canvas {
            display: block;
            margin: 10px auto;
            border: 1px solid #ccc;
        }
        .sprite-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .sprite-info {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        h1, h2 {
            text-align: center;
        }
        .path-test {
            text-align: center;
            margin: 30px 0;
        }
        canvas {
            border: 2px solid #333;
            background-color: white;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: 2px solid #333;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        button:hover {
            background-color: #45a049;
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(0);
        }
        .legend {
            text-align: center;
            margin: 20px auto;
            max-width: 800px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
        }
        .legend h3 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>🔧 Debug de Sprites das Curvas</h1>
    
    <div class="legend">
        <h3>📋 Legenda dos Tipos de Curva</h3>
        <p><strong>TL (Top-Left):</strong> Conecta entrada da esquerda com saída para baixo</p>
        <p><strong>TR (Top-Right):</strong> Conecta entrada da direita com saída para baixo</p>
        <p><strong>BL (Bottom-Left):</strong> Conecta entrada da esquerda com saída para cima</p>
        <p><strong>BR (Bottom-Right):</strong> Conecta entrada da direita com saída para cima</p>
        <p><strong>Horizontal/Vertical:</strong> Segmentos retos do caminho</p>
    </div>
    
    <h2>🎨 Sprites Individuais (Numerados)</h2>
    <div class="sprites-container" id="spritesContainer">
        <!-- Sprites serão inseridos aqui -->
    </div>
    
    <h2>🧪 Testes de Caminho Real (Com Debug)</h2>
    <div class="path-test">
        <button onclick="testSimpleCurve()">1. Curva Simples</button>
        <button onclick="testComplexPath()">2. Caminho Complexo</button>
        <button onclick="testMultipleCurves()">3. Múltiplas Curvas</button>
        <button onclick="testSnakePath()">4. Caminho Serpente</button>
        <button onclick="testSpiral()">5. Espiral Completa</button>
        <br><br>
        <canvas id="pathCanvas" width="900" height="600"></canvas>
        <div id="pathInfo" style="margin-top: 10px; font-family: monospace; background: #f0f0f0; padding: 10px; border-radius: 5px;"></div>
    </div>

    <script type="module">
        import { ImageManager } from './js/systems/ImageManager.js';
        
        const imageManager = new ImageManager();
        await imageManager.initializeDefault(80); // Sprites maiores para visualização
        
        // Mostrar todos os sprites das curvas
        const spriteTypes = [
            { type: 'path_horizontal', name: 'Horizontal', desc: 'Caminho reto horizontal' },
            { type: 'path_vertical', name: 'Vertical', desc: 'Caminho reto vertical' },
            { type: 'path_corner_tl', name: 'Curva TL', desc: 'Esquerda → Baixo' },
            { type: 'path_corner_tr', name: 'Curva TR', desc: 'Direita → Baixo' }, 
            { type: 'path_corner_bl', name: 'Curva BL', desc: 'Esquerda → Cima' },
            { type: 'path_corner_br', name: 'Curva BR', desc: 'Direita → Cima' },
            { type: 'path_start', name: 'Início', desc: 'Ponto de entrada' },
            { type: 'path_end', name: 'Fim', desc: 'Ponto de saída' },
            { type: 'grass', name: 'Grama', desc: 'Área para torres' }
        ];
        
        const container = document.getElementById('spritesContainer');
        
        spriteTypes.forEach((sprite, index) => {
            const div = document.createElement('div');
            div.className = 'sprite-box';
            
            // Número do sprite
            const number = document.createElement('div');
            number.className = 'sprite-number';
            number.textContent = index + 1;
            div.appendChild(number);
            
            const canvas = document.createElement('canvas');
            canvas.width = 80;
            canvas.height = 80;
            const ctx = canvas.getContext('2d');
            
            const spriteImage = imageManager.getImage(sprite.type);
            if (spriteImage) {
                ctx.drawImage(spriteImage, 0, 0);
            }
            
            const label = document.createElement('p');
            label.textContent = sprite.name;
            label.style.fontWeight = 'bold';
            label.style.margin = '5px 0';
            
            const info = document.createElement('div');
            info.className = 'sprite-info';
            info.textContent = sprite.desc;
            
            div.appendChild(canvas);
            div.appendChild(label);
            div.appendChild(info);
            container.appendChild(div);
        });
        
        // Testes de caminho
        const pathCanvas = document.getElementById('pathCanvas');
        const pathCtx = pathCanvas.getContext('2d');
        const pathInfo = document.getElementById('pathInfo');
        
        function drawPathWithDebug(path, description) {
            pathCtx.clearRect(0, 0, pathCanvas.width, pathCanvas.height);
            
            // Analisar tipos de tiles
            const pathTypes = imageManager.analyzePathTiles(path);
            
            // Desenhar fundo
            imageManager.createBackgroundPattern(pathCtx, pathCanvas.width, pathCanvas.height, 40, path);
            
            // Desenhar coordenadas e tipos para debug
            pathCtx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            pathCtx.font = '10px monospace';
            pathCtx.strokeStyle = 'white';
            pathCtx.lineWidth = 2;
            
            let typesSummary = {};
            
                         path.forEach((coord, index) => {
                 const x = coord.x * 40 + 20;
                 const y = coord.y * 40 + 25;
                 const tileType = pathTypes.get(`${coord.x},${coord.y}`) || 'unknown';
                 
                 // Contar tipos
                 typesSummary[tileType] = (typesSummary[tileType] || 0) + 1;
                 
                 // Só mostrar legendas para curvas (não para horizontal, vertical, start, end)
                 const isCurve = tileType.includes('corner_');
                 
                 if (isCurve) {
                     // Desenhar coordenada
                     pathCtx.strokeText(`${coord.x},${coord.y}`, x - 15, y);
                     pathCtx.fillText(`${coord.x},${coord.y}`, x - 15, y);
                     
                     // Desenhar índice do ponto
                     pathCtx.strokeText(`#${index}`, x - 8, y + 12);
                     pathCtx.fillText(`#${index}`, x - 8, y + 12);
                     
                     // Desenhar tipo abreviado
                     const typeAbbr = tileType.replace('path_', '').replace('corner_', '').toUpperCase();
                     pathCtx.fillStyle = 'rgba(255, 0, 0, 0.8)';
                     pathCtx.strokeText(typeAbbr, x - 10, y - 8);
                     pathCtx.fillText(typeAbbr, x - 10, y - 8);
                     pathCtx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                 }
             });
            
            // Mostrar informações
            let infoText = `<strong>${description}</strong><br>`;
            infoText += `Total de pontos: ${path.length}<br>`;
            infoText += `Tipos detectados:<br>`;
            
            Object.entries(typesSummary).forEach(([type, count]) => {
                const typeName = type.replace('path_', '').replace('_', ' ');
                infoText += `• ${typeName}: ${count}x<br>`;
            });
            
            pathInfo.innerHTML = infoText;
        }
        
        window.testSimpleCurve = function() {
            const path = [
                {x: 2, y: 2}, {x: 3, y: 2}, {x: 4, y: 2}, {x: 5, y: 2},
                {x: 5, y: 3}, {x: 5, y: 4}, {x: 5, y: 5}
            ];
            drawPathWithDebug(path, "Teste 1: Curva Simples (Horizontal → Vertical)");
        };
        
        window.testComplexPath = function() {
            const path = [
                // Horizontal
                {x: 1, y: 2}, {x: 2, y: 2}, {x: 3, y: 2}, {x: 4, y: 2},
                // Curva para baixo
                {x: 4, y: 3}, {x: 4, y: 4}, {x: 4, y: 5},
                // Curva para esquerda
                {x: 3, y: 5}, {x: 2, y: 5}, {x: 1, y: 5},
                // Curva para cima
                {x: 1, y: 4}, {x: 1, y: 3}
            ];
            drawPathWithDebug(path, "Teste 2: Caminho Retangular Complexo");
        };
        
        window.testMultipleCurves = function() {
            const path = [
                // Início horizontal
                {x: 1, y: 3}, {x: 2, y: 3}, {x: 3, y: 3}, {x: 4, y: 3},
                // Curva TL (horizontal → vertical baixo)
                {x: 4, y: 4}, {x: 4, y: 5}, {x: 4, y: 6},
                // Curva TR (vertical → horizontal esquerda)
                {x: 3, y: 6}, {x: 2, y: 6}, {x: 1, y: 6},
                // Curva BR (horizontal esquerda → vertical cima)
                {x: 1, y: 5}, {x: 1, y: 4},
                // Curva BL (vertical cima → horizontal direita)
                {x: 2, y: 4}, {x: 3, y: 4},
                // Curva TL novamente
                {x: 3, y: 5},
                // Final
                {x: 4, y: 5}, {x: 5, y: 5}, {x: 6, y: 5}, {x: 7, y: 5}
            ];
            drawPathWithDebug(path, "Teste 3: Múltiplas Curvas (TL, TR, BR, BL)");
        };
        
        window.testSnakePath = function() {
            const path = [
                // Linha 1
                {x: 1, y: 2}, {x: 2, y: 2}, {x: 3, y: 2}, {x: 4, y: 2}, {x: 5, y: 2}, {x: 6, y: 2}, {x: 7, y: 2},
                // Curva para baixo
                {x: 7, y: 3}, {x: 7, y: 4},
                // Linha 2 (volta)
                {x: 6, y: 4}, {x: 5, y: 4}, {x: 4, y: 4}, {x: 3, y: 4}, {x: 2, y: 4}, {x: 1, y: 4},
                // Curva para baixo
                {x: 1, y: 5}, {x: 1, y: 6},
                // Linha 3
                {x: 2, y: 6}, {x: 3, y: 6}, {x: 4, y: 6}, {x: 5, y: 6}, {x: 6, y: 6}, {x: 7, y: 6},
                // Curva para baixo
                {x: 7, y: 7}, {x: 7, y: 8},
                // Linha final
                {x: 6, y: 8}, {x: 5, y: 8}, {x: 4, y: 8}, {x: 3, y: 8}, {x: 2, y: 8}, {x: 1, y: 8}
            ];
            drawPathWithDebug(path, "Teste 4: Caminho Serpente (Ziguezague)");
        };
        
        window.testSpiral = function() {
            const path = [
                // Entrada externa
                {x: 1, y: 2}, {x: 2, y: 2}, {x: 3, y: 2}, {x: 4, y: 2}, {x: 5, y: 2}, {x: 6, y: 2}, {x: 7, y: 2}, {x: 8, y: 2},
                // Descida direita
                {x: 8, y: 3}, {x: 8, y: 4}, {x: 8, y: 5}, {x: 8, y: 6}, {x: 8, y: 7}, {x: 8, y: 8}, {x: 8, y: 9},
                // Esquerda embaixo
                {x: 7, y: 9}, {x: 6, y: 9}, {x: 5, y: 9}, {x: 4, y: 9}, {x: 3, y: 9}, {x: 2, y: 9}, {x: 1, y: 9},
                // Subida esquerda
                {x: 1, y: 8}, {x: 1, y: 7}, {x: 1, y: 6}, {x: 1, y: 5}, {x: 1, y: 4}, {x: 1, y: 3},
                // Espiral interna
                {x: 2, y: 3}, {x: 3, y: 3}, {x: 4, y: 3}, {x: 5, y: 3}, {x: 6, y: 3}, {x: 7, y: 3},
                // Descida interna
                {x: 7, y: 4}, {x: 7, y: 5}, {x: 7, y: 6}, {x: 7, y: 7}, {x: 7, y: 8},
                // Esquerda interna
                {x: 6, y: 8}, {x: 5, y: 8}, {x: 4, y: 8}, {x: 3, y: 8}, {x: 2, y: 8},
                // Subida final
                {x: 2, y: 7}, {x: 2, y: 6}, {x: 2, y: 5}, {x: 2, y: 4},
                // Centro
                {x: 3, y: 4}, {x: 4, y: 4}, {x: 5, y: 4}, {x: 6, y: 4}
            ];
            drawPathWithDebug(path, "Teste 5: Espiral Completa (Todas as curvas)");
        };
        
        // Carregar teste inicial - múltiplas curvas para demonstração
        testMultipleCurves();
        
        console.log('Debug de curvas carregado!');
    </script>
</body>
</html> 